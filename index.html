<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
    <script src="./leaflet.timeline.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
        .leaflet-timeline-controls{
            box-sizing: border-box;
            width: 100%;
            margin: 0;
            margin-bottom: 15px;
          }
    </style>

    <style>
    .map-overlay {
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        position: absolute;
        width: 25%;
        top: 0;
        left: 0;
        padding: 10px;
    }
     
    .map-overlay .map-overlay-inner {
    background-color: #fff;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    border-radius: 3px;
    padding: 10px;
    margin-bottom: 10px;
    }
     
    .map-overlay h2 {
    line-height: 24px;
    display: block;
    margin: 0 0 10px;
    }
     
    .map-overlay .legend .bar {
    height: 10px;
    width: 100%;
    background: linear-gradient(to right, rgba(56,168,0,1), rgba(255,56,0,1));
    }
     
    .map-overlay input {
    background-color: transparent;
    display: inline-block;
    width: 100%;
    position: relative;
    margin: 0;
    cursor: ew-resize;
    }
    </style>

</head>
<body>

    <div id="map"></div>
 
<div class="map-overlay top">
<div class="map-overlay-inner">
    <h1>Sheepshead</h2>
    <label id="year">2008</label>
    <input id="slider" type="range" min="2005" max="2011" step="1" value="">
</div>
<div class="map-overlay-inner">
<div id="legend" class="legend">
<div class="bar"></div>
<div>lbs (yr)</div>
</div>
</div>
</div>
 
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibXBhaHUiLCJhIjoiY2tyZmRhaGRqMzZkZjJxcjJnOWoyejJwaCJ9.Vd3zk7da05LpU8KM1kqtZA';
    var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location
        center: [-120.561, 34.271], // starting position [lng, lat]
        zoom: 8 // starting zoom
    });

    var years = [
        '2005',
        '2006',
        '2007',
        '2008',
        '2009',
        '2010',
        '2011'
        // '2012',
        // '2013',
        // '2014',
        // '2015',
        // '2016',
        // '2017',
        // '2018',
        // '2019',
        // '2020'
    ];
     
    function filterBy(year) {
        console.log(year)
        // var filters = ['get', year];
        // year = year.toString().slice(3);
        
        var mpasYear = `mpas-${year}`;
        // map.setFilter(mpasYear, filters);
        
        for (var year of years) {
            var  iYear = `mpas-${year}`;  
            map.setLayoutProperty(
                iYear,
                'visibility',
                'none'
            );
        }
        map.setLayoutProperty(
            mpasYear,
            'visibility',
            'visible'
        );
    }

    map.on('load', function() {

        map.addSource('smpa', {
            'type': 'vector',
            url: 'mapbox://mpahu.86v7vgbz'
        });
        
        map.addLayer({
            id: 'mpas-2005',
            type: 'fill',
            source: 'smpa',
            'source-layer': 'crfs_sps_rf_cshd-cagvov',
            'layout': {
                visibility: 'none',
            },
            paint: {
                // 'fill-color': ['-', 0, ['number', ['get', 'RF_2006'], 1]],
                'fill-opacity': 0.8,
                'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['get','RF_2005'],
                    0,
                    'transparent',
                    0.0000000001,
                    'rgba(56,168,0,1)',
                    6.3442333148500003,
                    'rgba(90,187,0,1)',
                    46.382601766800001,
                    'rgba(130,206,0,1)',
                    83.7009557234,
                    'rgba(175,226,0,1)',
                    138.48820086399999,
                    'rgba(227,245,0,1)',
                    215.70801481399999,
                    'rgba(255,226,0,1)',
                    321.83227328700002,
                    'rgba(255,170,0,1)',
                    461.69610297499997,
                    'rgba(255,113,0,1)',
                    659.59383335500002,
                    'rgba(255,56,0,1)',
                    1053.69263228,
                    'rgba(255,0,0,1)',
                ]
            },

        });

        map.addLayer({
            id: 'mpas-2006',
            type: 'fill',
            source: 'smpa',
            'layout': {
                visibility: 'none',
            },
            'source-layer': 'crfs_sps_rf_cshd-cagvov',
            paint: {
                // 'fill-color': ['-', 0, ['number', ['get', 'RF_2006'], 1]],
                'fill-opacity': 0.8,
                'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['get','RF_2006'],
                    0,
                    'transparent',
                    0.0000000001,
                    'rgba(56,168,0,1)',
                    6.3442333148500003,
                    'rgba(90,187,0,1)',
                    46.382601766800001,
                    'rgba(130,206,0,1)',
                    83.7009557234,
                    'rgba(175,226,0,1)',
                    138.48820086399999,
                    'rgba(227,245,0,1)',
                    215.70801481399999,
                    'rgba(255,226,0,1)',
                    321.83227328700002,
                    'rgba(255,170,0,1)',
                    461.69610297499997,
                    'rgba(255,113,0,1)',
                    659.59383335500002,
                    'rgba(255,56,0,1)',
                    1053.69263228,
                    'rgba(255,0,0,1)',
                ]
            },
        });

        map.addLayer({
            id: 'mpas-2007',
            type: 'fill',
            source: 'smpa',
            'layout': {
                visibility: 'none',
            },
            'source-layer': 'crfs_sps_rf_cshd-cagvov',
            paint: {
                // 'fill-color': ['-', 0, ['number', ['get', 'RF_2006'], 1]],
                'fill-opacity': 0.8,
                'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['get','RF_2007'],
                    0,
                    'transparent',
                    0.0000000001,
                    'rgba(56,168,0,1)',
                    6.3442333148500003,
                    'rgba(90,187,0,1)',
                    46.382601766800001,
                    'rgba(130,206,0,1)',
                    83.7009557234,
                    'rgba(175,226,0,1)',
                    138.48820086399999,
                    'rgba(227,245,0,1)',
                    215.70801481399999,
                    'rgba(255,226,0,1)',
                    321.83227328700002,
                    'rgba(255,170,0,1)',
                    461.69610297499997,
                    'rgba(255,113,0,1)',
                    659.59383335500002,
                    'rgba(255,56,0,1)',
                    1053.69263228,
                    'rgba(255,0,0,1)',
                ]
            },
        });

        map.addLayer({
            id: 'mpas-2008',
            type: 'fill',
            source: 'smpa',
            'layout': {
                visibility: 'visible',
            },
            'source-layer': 'crfs_sps_rf_cshd-cagvov',
            paint: {
                // 'fill-color': ['-', 0, ['number', ['get', 'RF_2006'], 1]],
                'fill-opacity': 0.8,
                'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['get','RF_2008'],
                    0,
                    'transparent',
                    0.0000000001,
                    'rgba(56,168,0,1)',
                    6.3442333148500003,
                    'rgba(90,187,0,1)',
                    46.382601766800001,
                    'rgba(130,206,0,1)',
                    83.7009557234,
                    'rgba(175,226,0,1)',
                    138.48820086399999,
                    'rgba(227,245,0,1)',
                    215.70801481399999,
                    'rgba(255,226,0,1)',
                    321.83227328700002,
                    'rgba(255,170,0,1)',
                    461.69610297499997,
                    'rgba(255,113,0,1)',
                    659.59383335500002,
                    'rgba(255,56,0,1)',
                    1053.69263228,
                    'rgba(255,0,0,1)',
                ]
            },
        });

        map.addLayer({
            id: 'mpas-2009',
            type: 'fill',
            source: 'smpa',
            'layout': {
                visibility: 'none',
            },
            'source-layer': 'crfs_sps_rf_cshd-cagvov',
            paint: {
                // 'fill-color': ['-', 0, ['number', ['get', 'RF_2006'], 1]],
                'fill-opacity': 0.8,
                'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['get','RF_2009'],
                    0,
                    'transparent',
                    0.0000000001,
                    'rgba(56,168,0,1)',
                    6.3442333148500003,
                    'rgba(90,187,0,1)',
                    46.382601766800001,
                    'rgba(130,206,0,1)',
                    83.7009557234,
                    'rgba(175,226,0,1)',
                    138.48820086399999,
                    'rgba(227,245,0,1)',
                    215.70801481399999,
                    'rgba(255,226,0,1)',
                    321.83227328700002,
                    'rgba(255,170,0,1)',
                    461.69610297499997,
                    'rgba(255,113,0,1)',
                    659.59383335500002,
                    'rgba(255,56,0,1)',
                    1053.69263228,
                    'rgba(255,0,0,1)',
                ]
            },
        });

        map.addLayer({
            id: 'mpas-2010',
            type: 'fill',
            source: 'smpa',
            'layout': {
                visibility: 'none',
            },
            'source-layer': 'crfs_sps_rf_cshd-cagvov',
            paint: {
                // 'fill-color': ['-', 0, ['number', ['get', 'RF_2006'], 1]],
                'fill-opacity': 0.8,
                'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['get','RF_2010'],
                    0,
                    'transparent',
                    0.0000000001,
                    'rgba(56,168,0,1)',
                    6.3442333148500003,
                    'rgba(90,187,0,1)',
                    46.382601766800001,
                    'rgba(130,206,0,1)',
                    83.7009557234,
                    'rgba(175,226,0,1)',
                    138.48820086399999,
                    'rgba(227,245,0,1)',
                    215.70801481399999,
                    'rgba(255,226,0,1)',
                    321.83227328700002,
                    'rgba(255,170,0,1)',
                    461.69610297499997,
                    'rgba(255,113,0,1)',
                    659.59383335500002,
                    'rgba(255,56,0,1)',
                    1053.69263228,
                    'rgba(255,0,0,1)',
                ]
            },
        });

        map.addLayer({
            id: 'mpas-2011',
            type: 'fill',
            source: 'smpa',
            'layout': {
                visibility: 'none',
            },
            'source-layer': 'crfs_sps_rf_cshd-cagvov',
            paint: {
                // 'fill-color': ['-', 0, ['number', ['get', 'RF_2006'], 1]],
                'fill-opacity': 0.8,
                'fill-color': [
                    'interpolate',
                    ['linear'],
                    ['get','RF_2011'],
                    0,
                    'transparent',
                    0.0000000001,
                    'rgba(56,168,0,1)',
                    6.3442333148500003,
                    'rgba(90,187,0,1)',
                    46.382601766800001,
                    'rgba(130,206,0,1)',
                    83.7009557234,
                    'rgba(175,226,0,1)',
                    138.48820086399999,
                    'rgba(227,245,0,1)',
                    215.70801481399999,
                    'rgba(255,226,0,1)',
                    321.83227328700002,
                    'rgba(255,170,0,1)',
                    461.69610297499997,
                    'rgba(255,113,0,1)',
                    659.59383335500002,
                    'rgba(255,56,0,1)',
                    1053.69263228,
                    'rgba(255,0,0,1)',
                ]
            },
        });


        // Set filter to first month of the year
        // RF_2005 = 2005
        // 
    // filterBy('RF_2006');
         
    });

    document
        .getElementById('slider')
        .addEventListener('input', function (e) {
            var year = parseInt(e.target.value, 10);
            // year = 'RF_' + year;
            filterBy(year);
            document.getElementById('year').innerHTML = year;
    });


</script>

</body>
</html>
